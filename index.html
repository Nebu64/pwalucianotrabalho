<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZAnime</title>
  
  <!-- PWA Meta Tags -->
  <link rel="stylesheet" href="./style.css" />
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#7ecf6b" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ZAnime">
  <meta name="description" content="Assista seus animes favoritos">
  <meta name="keywords" content="anime, filmes, s√©ries, streaming">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="./icon-192.png">
</head>
<body>
  <header>
    <div class="header-left">
      <img src="logo.png" class="site-logo" alt="Logo" />
      <nav>
        <a href="#" id="nav-home" class="active">In√≠cio</a>
        <a href="#" id="nav-filmes">Filmes</a>
        <a href="#" id="nav-series">S√©ries</a>
      </nav>
    </div>
    <form id="search-form" class="search-top-form">
      <input id="search-input" type="search" placeholder="Buscar anime..." autocomplete="off" />
      <button type="submit">Buscar</button>
    </form>
  </header>

  <main>
    <!-- Se√ß√£o Home -->
    <section id="home-section">
      <h1 style="margin-bottom:22px;">Bem-vindo ao ZAnime</h1>

      <!-- Carrossel de lan√ßamentos -->
      <div class="carousel-title">Lan√ßamentos</div>
      <div class="carousel-wrapper">
        <button id="carousel-lancamentos-prev" class="carousel-arrow left" aria-label="Anterior">&lt;</button>
        <div id="carousel-lancamentos" class="main-carousel"></div>
        <button id="carousel-lancamentos-next" class="carousel-arrow right" aria-label="Pr√≥ximo">&gt;</button>
      </div>

      <!-- Carrossel de populares -->
      <div class="carousel-title">Mais assistidos</div>
      <div class="carousel-wrapper">
        <button id="carousel-populares-prev" class="carousel-arrow left" aria-label="Anterior">&lt;</button>
        <div id="carousel-populares" class="small-carousel"></div>
        <button id="carousel-populares-next" class="carousel-arrow right" aria-label="Pr√≥ximo">&gt;</button>
      </div>
    </section>

    <!-- Se√ß√£o Player -->
    <section id="player-section" class="hidden">
      <div id="player-info"></div>
      <div class="video-player"></div>
      <button id="back-to-home">Voltar</button>
    </section>

    <!-- Se√ß√£o Busca Geral -->
    <section id="search-results" class="hidden">
      <div id="search-animes"></div>
    </section>

    <!-- Se√ß√£o Epis√≥dios -->
    <section id="episodes-section" class="hidden">
      <h3>Epis√≥dios</h3>
      <ul id="episodes-list"></ul>
      <button id="close-episodes">Fechar</button>
    </section>

    <!-- Se√ß√£o G√™neros -->
    <section id="generos-section" class="hidden">
      <div class="generos-header">
        <h2>Filtrar por G√™nero</h2>
      </div>
      <div id="generos-list"></div>
      <div id="generos-animes-result"></div>
    </section>

    <!-- Se√ß√£o Filmes -->
    <section id="filmes-section" class="hidden">
      <h2>Filmes</h2>
      <form id="filmes-search-form" class="search-top-form" style="margin-bottom:24px;">
        <input id="filmes-search-input" type="search" placeholder="Buscar filme..." autocomplete="off" />
        <button type="submit">Buscar</button>
      </form>
      <div id="filmes-lista"></div>
    </section>

    <!-- Se√ß√£o S√©ries -->
    <section id="series-section" class="hidden">
      <h2>S√©ries</h2>
      <form id="series-search-form" class="search-top-form" style="margin-bottom:24px;">
        <input id="series-search-input" type="search" placeholder="Buscar s√©rie..." autocomplete="off" />
        <button type="submit">Buscar</button>
      </form>
      <div id="series-lista"></div>
    </section>
  </main>

  <script src="./script.js"></script>

  <script>
    // Configura√ß√£o autom√°tica para GitHub Pages
    const repoName = 'pwalucianotrabalho';
    const basePath = window.location.hostname === 'localhost' ? '' : `/${repoName}`;

    // Configurar Service Worker dinamicamente
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        const swPath = basePath ? `${basePath}/service-worker.js` : './service-worker.js';
        
        navigator.serviceWorker.register(swPath)
          .then(function(registration) {
            console.log('ServiceWorker registrado com sucesso: ', registration.scope);
          })
          .catch(function(err) {
            console.log('Falha ao registrar ServiceWorker: ', err);
          });
      });
    }

    // Corrigir links para funcionar no GitHub Pages
    document.addEventListener('DOMContentLoaded', function() {
      // Atualizar action dos forms
      const forms = document.querySelectorAll('form');
      forms.forEach(form => {
        const originalAction = form.getAttribute('action');
        if (originalAction && originalAction.startsWith('./')) {
          form.setAttribute('action', basePath + originalAction.substring(1));
        }
      });

      // Atualizar links de navega√ß√£o
      const links = document.querySelectorAll('a[href^="./"]');
      links.forEach(link => {
        const originalHref = link.getAttribute('href');
        if (!originalHref.includes('#')) {
          link.setAttribute('href', basePath + originalHref.substring(1));
        }
      });
    });

    // Gerenciar instala√ß√£o PWA
    let deferredPrompt;
    const installButton = document.createElement('button');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      showInstallButton();
    });

    function showInstallButton() {
      installButton.innerHTML = 'üì± Instalar App';
      installButton.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: orange;
        color: white;
        border: none;
        border-radius: 25px;
        padding: 12px 20px;
        font-size: 14px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 1000;
        font-family: inherit;
      `;
      
      installButton.addEventListener('click', installPWA);
      document.body.appendChild(installButton);
    }

    function installPWA() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('PWA instalado com sucesso');
            installButton.remove();
          }
          deferredPrompt = null;
        });
      }
    }

    window.addEventListener('appinstalled', () => {
      console.log('PWA foi instalado');
      installButton.remove();
    });

    // Verificar se j√° est√° em modo PWA
    if (window.matchMedia('(display-mode: standalone)').matches) {
      document.body.classList.add('pwa-mode');
      if (installButton.parentNode) {
        installButton.remove();
      }
    }
  </script>
</body>
</html>
